<?php
class Mobile_API extends CI_Controller {
 
    /**
    * Responsable for auto load the model
    * @return void
    */
    public function __construct()
    {
        parent::__construct();
        $this->load->model('users_model');
		$this->load->model('products_model');
    }

	/**
    * encript the password 
    * @return mixed
    */	
    function __encrip_password($password) {
        return md5($password);
    }	

	function json_response($data){
		header('Content-Type: application/json; charset=UTF8');
		echo trim(json_encode($data));
	}

    /**
    * check the username and the password with the database
    * @return void
    */
	function validate_credentials()
	{	
		$user_name = $this->input->post('username');
		$password = $this->__encrip_password($this->input->post('password'));

		$user = $this->users_model->validate($user_name, $password);
		
		if($user)
		{
			$data = array();
			$data['status'] = 0;
			$data['data'] = $user[0];
			$this->json_response($data);
		}
		else // incorrect username or password
		{
			$data = array();
			$data['status'] = 1;
			$data['message'] = "Username or Password is not valid";
			$this->json_response($data);
		}
	}

	/**
    * Load the main view with all the current model model's data.
    * @return void
    */
    public function products()
    {
		$user_id = (int)$this->input->get('user_id');
		if($user_id > 0){
			$data = array();
			$data['status'] = 0;
			$data['data']['count_products']= $this->products_model->count_products();
		    $data['data']['products'] = $this->products_model->get_products('', '', 'ASC', 0,5);
			$this->json_response($data);
		}
		else
		{
			$data = array();
			$data['status'] = 1;
			$data['message'] = "You are not authorised user.";
			$this->json_response($data);
		}
	}
}
